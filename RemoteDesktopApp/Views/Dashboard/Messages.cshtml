@{
    ViewData["Title"] = "Messages";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<div class="fade-in">
    <!-- Messages Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-1">
                        <i class="fas fa-comments text-primary me-2"></i>Messages
                    </h1>
                    <p class="text-muted mb-0">Stay connected with your team</p>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary" onclick="showNewGroupModal()">
                        <i class="fas fa-users me-1"></i>New Group
                    </button>
                    <button class="btn btn-primary" onclick="showNewMessageModal()">
                        <i class="fas fa-plus me-1"></i>New Message
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Messages Layout -->
    <div class="row">
        <!-- Conversations Sidebar -->
        <div class="col-lg-4 col-xl-3 mb-4">
            <div class="messages-sidebar">
                <!-- Search -->
                <div class="search-box mb-3">
                    <div class="input-group">
                        <span class="input-group-text">
                            <i class="fas fa-search"></i>
                        </span>
                        <input type="text" class="form-control" id="searchMessages" placeholder="Search conversations...">
                    </div>
                </div>

                <!-- Filter Tabs -->
                <ul class="nav nav-pills nav-fill mb-3" id="conversationTabs">
                    <li class="nav-item">
                        <button class="nav-link active" id="all-tab" data-filter="all">All</button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="unread-tab" data-filter="unread">Unread</button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="groups-tab" data-filter="groups">Groups</button>
                    </li>
                </ul>

                <!-- Conversations List -->
                <div class="conversations-list" id="conversationsList">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2 text-muted">Loading conversations...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="col-lg-8 col-xl-9">
            <div class="chat-container">
                <!-- Welcome Screen -->
                <div class="chat-welcome" id="chatWelcome">
                    <div class="text-center py-5">
                        <i class="fas fa-comments fa-4x text-muted mb-3"></i>
                        <h4 class="text-muted">Select a conversation to start messaging</h4>
                        <p class="text-muted">Choose from your existing conversations or start a new one</p>
                    </div>
                </div>

                <!-- Chat Interface -->
                <div class="chat-interface d-none" id="chatInterface">
                    <!-- Chat Header -->
                    <div class="chat-header">
                        <div class="d-flex align-items-center">
                            <img src="/images/default-avatar.svg" alt="Avatar" class="chat-avatar me-3" id="chatAvatar">
                            <div class="flex-grow-1">
                                <h6 class="mb-0" id="chatTitle">Conversation</h6>
                                <small class="text-muted" id="chatSubtitle">Online</small>
                            </div>
                            <div class="chat-actions">
                                <button class="btn btn-sm btn-outline-secondary me-2" onclick="showChatInfo()">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="toggleChatMute()">
                                    <i class="fas fa-bell" id="muteIcon"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Messages Area -->
                    <div class="messages-area" id="messagesArea">
                        <div class="messages-container" id="messagesContainer">
                            <!-- Messages will be loaded here -->
                        </div>
                    </div>

                    <!-- Message Input -->
                    <div class="message-input-area">
                        <div class="message-input-container">
                            <button class="btn btn-sm btn-outline-secondary attachment-btn" onclick="selectAttachment()">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <div class="message-input-wrapper">
                                <textarea class="form-control message-input" id="messageInput" placeholder="Type a message..." rows="1"></textarea>
                                <div class="emoji-picker-btn">
                                    <button class="btn btn-sm btn-outline-secondary" onclick="toggleEmojiPicker()">
                                        <i class="fas fa-smile"></i>
                                    </button>
                                </div>
                            </div>
                            <button class="btn btn-primary send-btn" id="sendBtn" onclick="sendMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <input type="file" id="attachmentInput" style="display: none;" accept="image/*,video/*,audio/*,.pdf,.doc,.docx,.txt">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- New Message Modal -->
<div class="modal fade" id="newMessageModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">New Message</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="newMessageForm">
                    <div class="mb-3">
                        <label for="recipientSelect" class="form-label">To:</label>
                        <select class="form-select" id="recipientSelect" required>
                            <option value="">Select a user...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="newMessageContent" class="form-label">Message:</label>
                        <textarea class="form-control" id="newMessageContent" rows="4" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="sendNewMessage()">Send Message</button>
            </div>
        </div>
    </div>
</div>

<!-- New Group Modal -->
<div class="modal fade" id="newGroupModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create Group</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="newGroupForm">
                    <div class="mb-3">
                        <label for="groupName" class="form-label">Group Name:</label>
                        <input type="text" class="form-control" id="groupName" required>
                    </div>
                    <div class="mb-3">
                        <label for="groupDescription" class="form-label">Description:</label>
                        <textarea class="form-control" id="groupDescription" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="groupParticipants" class="form-label">Participants:</label>
                        <select class="form-select" id="groupParticipants" multiple required>
                            <!-- Users will be loaded here -->
                        </select>
                        <div class="form-text">Hold Ctrl/Cmd to select multiple users</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="createGroup()">Create Group</button>
            </div>
        </div>
    </div>
</div>

<!-- Chat Info Modal -->
<div class="modal fade" id="chatInfoModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Chat Information</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="chatInfoContent">
                    <!-- Chat info will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Emoji Picker -->
<div class="emoji-picker d-none" id="emojiPicker">
    <div class="emoji-grid">
        <span class="emoji" onclick="insertEmoji('😀')">😀</span>
        <span class="emoji" onclick="insertEmoji('😃')">😃</span>
        <span class="emoji" onclick="insertEmoji('😄')">😄</span>
        <span class="emoji" onclick="insertEmoji('😁')">😁</span>
        <span class="emoji" onclick="insertEmoji('😆')">😆</span>
        <span class="emoji" onclick="insertEmoji('😅')">😅</span>
        <span class="emoji" onclick="insertEmoji('😂')">😂</span>
        <span class="emoji" onclick="insertEmoji('🤣')">🤣</span>
        <span class="emoji" onclick="insertEmoji('😊')">😊</span>
        <span class="emoji" onclick="insertEmoji('😇')">😇</span>
        <span class="emoji" onclick="insertEmoji('🙂')">🙂</span>
        <span class="emoji" onclick="insertEmoji('🙃')">🙃</span>
        <span class="emoji" onclick="insertEmoji('😉')">😉</span>
        <span class="emoji" onclick="insertEmoji('😌')">😌</span>
        <span class="emoji" onclick="insertEmoji('😍')">😍</span>
        <span class="emoji" onclick="insertEmoji('🥰')">🥰</span>
        <span class="emoji" onclick="insertEmoji('😘')">😘</span>
        <span class="emoji" onclick="insertEmoji('😗')">😗</span>
        <span class="emoji" onclick="insertEmoji('😙')">😙</span>
        <span class="emoji" onclick="insertEmoji('😚')">😚</span>
        <span class="emoji" onclick="insertEmoji('😋')">😋</span>
        <span class="emoji" onclick="insertEmoji('😛')">😛</span>
        <span class="emoji" onclick="insertEmoji('😝')">😝</span>
        <span class="emoji" onclick="insertEmoji('😜')">😜</span>
        <span class="emoji" onclick="insertEmoji('🤪')">🤪</span>
        <span class="emoji" onclick="insertEmoji('🤨')">🤨</span>
        <span class="emoji" onclick="insertEmoji('🧐')">🧐</span>
        <span class="emoji" onclick="insertEmoji('🤓')">🤓</span>
        <span class="emoji" onclick="insertEmoji('😎')">😎</span>
        <span class="emoji" onclick="insertEmoji('🤩')">🤩</span>
        <span class="emoji" onclick="insertEmoji('🥳')">🥳</span>
        <span class="emoji" onclick="insertEmoji('😏')">😏</span>
        <span class="emoji" onclick="insertEmoji('😒')">😒</span>
        <span class="emoji" onclick="insertEmoji('😞')">😞</span>
        <span class="emoji" onclick="insertEmoji('😔')">😔</span>
        <span class="emoji" onclick="insertEmoji('😟')">😟</span>
        <span class="emoji" onclick="insertEmoji('😕')">😕</span>
        <span class="emoji" onclick="insertEmoji('🙁')">🙁</span>
        <span class="emoji" onclick="insertEmoji('☹️')">☹️</span>
        <span class="emoji" onclick="insertEmoji('😣')">😣</span>
        <span class="emoji" onclick="insertEmoji('😖')">😖</span>
        <span class="emoji" onclick="insertEmoji('😫')">😫</span>
        <span class="emoji" onclick="insertEmoji('😩')">😩</span>
        <span class="emoji" onclick="insertEmoji('🥺')">🥺</span>
        <span class="emoji" onclick="insertEmoji('😢')">😢</span>
        <span class="emoji" onclick="insertEmoji('😭')">😭</span>
        <span class="emoji" onclick="insertEmoji('😤')">😤</span>
        <span class="emoji" onclick="insertEmoji('😠')">😠</span>
        <span class="emoji" onclick="insertEmoji('😡')">😡</span>
        <span class="emoji" onclick="insertEmoji('🤬')">🤬</span>
        <span class="emoji" onclick="insertEmoji('🤯')">🤯</span>
        <span class="emoji" onclick="insertEmoji('😳')">😳</span>
        <span class="emoji" onclick="insertEmoji('🥵')">🥵</span>
        <span class="emoji" onclick="insertEmoji('🥶')">🥶</span>
        <span class="emoji" onclick="insertEmoji('😱')">😱</span>
        <span class="emoji" onclick="insertEmoji('😨')">😨</span>
        <span class="emoji" onclick="insertEmoji('😰')">😰</span>
        <span class="emoji" onclick="insertEmoji('😥')">😥</span>
        <span class="emoji" onclick="insertEmoji('😓')">😓</span>
        <span class="emoji" onclick="insertEmoji('🤗')">🤗</span>
        <span class="emoji" onclick="insertEmoji('🤔')">🤔</span>
        <span class="emoji" onclick="insertEmoji('🤭')">🤭</span>
        <span class="emoji" onclick="insertEmoji('🤫')">🤫</span>
        <span class="emoji" onclick="insertEmoji('🤥')">🤥</span>
        <span class="emoji" onclick="insertEmoji('😶')">😶</span>
        <span class="emoji" onclick="insertEmoji('😐')">😐</span>
        <span class="emoji" onclick="insertEmoji('😑')">😑</span>
        <span class="emoji" onclick="insertEmoji('😬')">😬</span>
        <span class="emoji" onclick="insertEmoji('🙄')">🙄</span>
        <span class="emoji" onclick="insertEmoji('😯')">😯</span>
        <span class="emoji" onclick="insertEmoji('😦')">😦</span>
        <span class="emoji" onclick="insertEmoji('😧')">😧</span>
        <span class="emoji" onclick="insertEmoji('😮')">😮</span>
        <span class="emoji" onclick="insertEmoji('😲')">😲</span>
        <span class="emoji" onclick="insertEmoji('🥱')">🥱</span>
        <span class="emoji" onclick="insertEmoji('😴')">😴</span>
        <span class="emoji" onclick="insertEmoji('🤤')">🤤</span>
        <span class="emoji" onclick="insertEmoji('😪')">😪</span>
        <span class="emoji" onclick="insertEmoji('😵')">😵</span>
        <span class="emoji" onclick="insertEmoji('🤐')">🤐</span>
        <span class="emoji" onclick="insertEmoji('🥴')">🥴</span>
        <span class="emoji" onclick="insertEmoji('🤢')">🤢</span>
        <span class="emoji" onclick="insertEmoji('🤮')">🤮</span>
        <span class="emoji" onclick="insertEmoji('🤧')">🤧</span>
        <span class="emoji" onclick="insertEmoji('😷')">😷</span>
        <span class="emoji" onclick="insertEmoji('🤒')">🤒</span>
        <span class="emoji" onclick="insertEmoji('🤕')">🤕</span>
        <span class="emoji" onclick="insertEmoji('🤑')">🤑</span>
        <span class="emoji" onclick="insertEmoji('🤠')">🤠</span>
        <span class="emoji" onclick="insertEmoji('😈')">😈</span>
        <span class="emoji" onclick="insertEmoji('👿')">👿</span>
        <span class="emoji" onclick="insertEmoji('👹')">👹</span>
        <span class="emoji" onclick="insertEmoji('👺')">👺</span>
        <span class="emoji" onclick="insertEmoji('🤡')">🤡</span>
        <span class="emoji" onclick="insertEmoji('💩')">💩</span>
        <span class="emoji" onclick="insertEmoji('👻')">👻</span>
        <span class="emoji" onclick="insertEmoji('💀')">💀</span>
        <span class="emoji" onclick="insertEmoji('☠️')">☠️</span>
        <span class="emoji" onclick="insertEmoji('👽')">👽</span>
        <span class="emoji" onclick="insertEmoji('👾')">👾</span>
        <span class="emoji" onclick="insertEmoji('🤖')">🤖</span>
        <span class="emoji" onclick="insertEmoji('🎃')">🎃</span>
        <span class="emoji" onclick="insertEmoji('😺')">😺</span>
        <span class="emoji" onclick="insertEmoji('😸')">😸</span>
        <span class="emoji" onclick="insertEmoji('😹')">😹</span>
        <span class="emoji" onclick="insertEmoji('😻')">😻</span>
        <span class="emoji" onclick="insertEmoji('😼')">😼</span>
        <span class="emoji" onclick="insertEmoji('😽')">😽</span>
        <span class="emoji" onclick="insertEmoji('🙀')">🙀</span>
        <span class="emoji" onclick="insertEmoji('😿')">😿</span>
        <span class="emoji" onclick="insertEmoji('😾')">😾</span>
        <span class="emoji" onclick="insertEmoji('👋')">👋</span>
        <span class="emoji" onclick="insertEmoji('🤚')">🤚</span>
        <span class="emoji" onclick="insertEmoji('🖐️')">🖐️</span>
        <span class="emoji" onclick="insertEmoji('✋')">✋</span>
        <span class="emoji" onclick="insertEmoji('🖖')">🖖</span>
        <span class="emoji" onclick="insertEmoji('👌')">👌</span>
        <span class="emoji" onclick="insertEmoji('🤏')">🤏</span>
        <span class="emoji" onclick="insertEmoji('✌️')">✌️</span>
        <span class="emoji" onclick="insertEmoji('🤞')">🤞</span>
        <span class="emoji" onclick="insertEmoji('🤟')">🤟</span>
        <span class="emoji" onclick="insertEmoji('🤘')">🤘</span>
        <span class="emoji" onclick="insertEmoji('🤙')">🤙</span>
        <span class="emoji" onclick="insertEmoji('👈')">👈</span>
        <span class="emoji" onclick="insertEmoji('👉')">👉</span>
        <span class="emoji" onclick="insertEmoji('👆')">👆</span>
        <span class="emoji" onclick="insertEmoji('🖕')">🖕</span>
        <span class="emoji" onclick="insertEmoji('👇')">👇</span>
        <span class="emoji" onclick="insertEmoji('☝️')">☝️</span>
        <span class="emoji" onclick="insertEmoji('👍')">👍</span>
        <span class="emoji" onclick="insertEmoji('👎')">👎</span>
        <span class="emoji" onclick="insertEmoji('✊')">✊</span>
        <span class="emoji" onclick="insertEmoji('👊')">👊</span>
        <span class="emoji" onclick="insertEmoji('🤛')">🤛</span>
        <span class="emoji" onclick="insertEmoji('🤜')">🤜</span>
        <span class="emoji" onclick="insertEmoji('👏')">👏</span>
        <span class="emoji" onclick="insertEmoji('🙌')">🙌</span>
        <span class="emoji" onclick="insertEmoji('👐')">👐</span>
        <span class="emoji" onclick="insertEmoji('🤲')">🤲</span>
        <span class="emoji" onclick="insertEmoji('🤝')">🤝</span>
        <span class="emoji" onclick="insertEmoji('🙏')">🙏</span>
        <span class="emoji" onclick="insertEmoji('✍️')">✍️</span>
        <span class="emoji" onclick="insertEmoji('💅')">💅</span>
        <span class="emoji" onclick="insertEmoji('🤳')">🤳</span>
        <span class="emoji" onclick="insertEmoji('💪')">💪</span>
        <span class="emoji" onclick="insertEmoji('🦾')">🦾</span>
        <span class="emoji" onclick="insertEmoji('🦿')">🦿</span>
        <span class="emoji" onclick="insertEmoji('🦵')">🦵</span>
        <span class="emoji" onclick="insertEmoji('🦶')">🦶</span>
        <span class="emoji" onclick="insertEmoji('👂')">👂</span>
        <span class="emoji" onclick="insertEmoji('🦻')">🦻</span>
        <span class="emoji" onclick="insertEmoji('👃')">👃</span>
        <span class="emoji" onclick="insertEmoji('🧠')">🧠</span>
        <span class="emoji" onclick="insertEmoji('🦷')">🦷</span>
        <span class="emoji" onclick="insertEmoji('🦴')">🦴</span>
        <span class="emoji" onclick="insertEmoji('👀')">👀</span>
        <span class="emoji" onclick="insertEmoji('👁️')">👁️</span>
        <span class="emoji" onclick="insertEmoji('👅')">👅</span>
        <span class="emoji" onclick="insertEmoji('👄')">👄</span>
        <span class="emoji" onclick="insertEmoji('💋')">💋</span>
        <span class="emoji" onclick="insertEmoji('🩸')">🩸</span>
        <span class="emoji" onclick="insertEmoji('❤️')">❤️</span>
        <span class="emoji" onclick="insertEmoji('🧡')">🧡</span>
        <span class="emoji" onclick="insertEmoji('💛')">💛</span>
        <span class="emoji" onclick="insertEmoji('💚')">💚</span>
        <span class="emoji" onclick="insertEmoji('💙')">💙</span>
        <span class="emoji" onclick="insertEmoji('💜')">💜</span>
        <span class="emoji" onclick="insertEmoji('🤎')">🤎</span>
        <span class="emoji" onclick="insertEmoji('🖤')">🖤</span>
        <span class="emoji" onclick="insertEmoji('🤍')">🤍</span>
        <span class="emoji" onclick="insertEmoji('💔')">💔</span>
        <span class="emoji" onclick="insertEmoji('❣️')">❣️</span>
        <span class="emoji" onclick="insertEmoji('💕')">💕</span>
        <span class="emoji" onclick="insertEmoji('💞')">💞</span>
        <span class="emoji" onclick="insertEmoji('💓')">💓</span>
        <span class="emoji" onclick="insertEmoji('💗')">💗</span>
        <span class="emoji" onclick="insertEmoji('💖')">💖</span>
        <span class="emoji" onclick="insertEmoji('💘')">💘</span>
        <span class="emoji" onclick="insertEmoji('💝')">💝</span>
        <span class="emoji" onclick="insertEmoji('💟')">💟</span>
        <span class="emoji" onclick="insertEmoji('♥️')">♥️</span>
        <span class="emoji" onclick="insertEmoji('💯')">💯</span>
        <span class="emoji" onclick="insertEmoji('💢')">💢</span>
        <span class="emoji" onclick="insertEmoji('💥')">💥</span>
        <span class="emoji" onclick="insertEmoji('💫')">💫</span>
        <span class="emoji" onclick="insertEmoji('💦')">💦</span>
        <span class="emoji" onclick="insertEmoji('💨')">💨</span>
        <span class="emoji" onclick="insertEmoji('🕳️')">🕳️</span>
        <span class="emoji" onclick="insertEmoji('💣')">💣</span>
        <span class="emoji" onclick="insertEmoji('💬')">💬</span>
        <span class="emoji" onclick="insertEmoji('👁️‍🗨️')">👁️‍🗨️</span>
        <span class="emoji" onclick="insertEmoji('🗨️')">🗨️</span>
        <span class="emoji" onclick="insertEmoji('🗯️')">🗯️</span>
        <span class="emoji" onclick="insertEmoji('💭')">💭</span>
        <span class="emoji" onclick="insertEmoji('💤')">💤</span>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="~/css/messages.css" asp-append-version="true" />
    <script src="~/js/messages.js" asp-append-version="true"></script>
}
